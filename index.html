<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Loadout Live</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body { margin:0; background:#111; color:#eee; font-family:Arial,sans-serif; }
h2 { text-align:center; margin:15px 0; }
.container { display:flex; gap:60px; padding:20px; }
.team { flex:1; background:#1e1e1e; padding:15px; border-radius:10px; }
.player { background:#2b2b2b; padding:8px; margin-bottom:6px; border-radius:6px; cursor:pointer; }
.player.active { outline:2px solid #4caf50; }
.player.duplicate { border:2px solid red; }
.player input { width:95%; font-weight:bold; background:#222; color:#eee; border:none; outline:none; }
.loadout span { margin-right:10px; opacity:0.85; }
.loadout span.duplicate { color:red; }
.panel-container { display:flex; gap:60px; padding:0 20px; }
.panel { flex:1; margin-top:10px; padding:15px; background:#1b1b1b; border-radius:10px; }
.section { margin-bottom:12px; }
.options { display:flex; flex-wrap:wrap; gap:6px; }
.option { padding:6px 10px; background:#444; border-radius:5px; cursor:pointer; user-select:none; }
.option.disabled { opacity:0.3; cursor:not-allowed; }
.option.active { outline:2px solid #4caf50; }
.option.duplicate { background:red; color:#fff; border:2px solid red; }
.duplicate-warning { color:red; font-weight:bold; margin-bottom:5px; }
.admin { text-align:center; margin-bottom:15px; }
button { padding:6px 12px; margin:4px; }
select { padding:6px; }
</style>
</head>
<body>

<h2>Loadout Live</h2>

<div class="container">
  <div class="team">
    <h3>Dru≈ºyna A</h3>
    <div id="teamA"></div>
    <div id="dupWarningA" class="duplicate-warning" style="display:none">‚ö†Ô∏è Duplikaty w dru≈ºynie!</div>
  </div>
  <div class="team">
    <h3>Dru≈ºyna B</h3>
    <div id="teamB"></div>
    <div id="dupWarningB" class="duplicate-warning" style="display:none">‚ö†Ô∏è Duplikaty w dru≈ºynie!</div>
  </div>
</div>

<div class="panel-container">
  <div class="panel">
    <h4>Opcje Dru≈ºyny A</h4>
    <div class="section"><b>Tytany</b><div class="options" id="titansA"></div></div>
    <div class="section"><b>Bronie ciƒô≈ºkie</b><div class="options" id="weaponsA"></div></div>
    <div class="section"><b>Umiejƒôtno≈õci taktyczne</b><div class="options" id="tacticalsA"></div></div>
  </div>

  <div class="panel">
    <h4>Opcje Dru≈ºyny B</h4>
    <div class="section"><b>Tytany</b><div class="options" id="titansB"></div></div>
    <div class="section"><b>Bronie ciƒô≈ºkie</b><div class="options" id="weaponsB"></div></div>
    <div class="section"><b>Umiejƒôtno≈õci taktyczne</b><div class="options" id="tacticalsB"></div></div>
  </div>
</div>

<div class="admin" id="adminPanel">
  <button onclick="addPlayer()">‚ûï Dodaj gracza</button>
  <button onclick="removePlayer()">‚ûñ Usu≈Ñ gracza</button>
  <button onclick="movePlayer()">‚áÑ Przenie≈õ gracza</button>
  <button onclick="resetLoadouts()">üîÑ Reset loadout√≥w</button>
</div>

<script>
const isAdmin = location.search.includes("admin=1");
document.getElementById("adminPanel").style.display = isAdmin ? "block" : "none";

/* ===== FIREBASE ===== */
const firebaseConfig = {
  apiKey: "AIzaSyCIi8Jl0rEPsNOfFERMUSl-MV3lDiEOsVI",
  authDomain: "tabela-turniejowa-titanfall-2.firebaseapp.com",
  databaseURL: "https://tabela-turniejowa-titanfall-2-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "tabela-turniejowa-titanfall-2",
  storageBucket: "tabela-turniejowa-titanfall-2.firebasestorage.app",
  messagingSenderId: "887537927614",
  appId: "1:887537927614:web:28f6f7e303e1a57d00e5ef"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ===== STA≈ÅE ===== */
const TITANS = ["Kationa","Spopielacz","Polaris","Ronin","Ton","Legion","Monarcha"];
const WEAPONS = ["Granat od≈Çamkowy","Granat ≈Çukowy","Ognista gwiazda","Gwiazda grawitacyjna","Granat elektro-dymny","Ciƒô≈ºki ≈Çadunek wybuchowy"];
const TACTICALS = ["Maskowanie","Ostrze pulsacyjne","Linka z hakiem","Stymulant","≈öciana energetyczna","Przeskok fazowy","Holopilot"];
const LIMITED_TACTICALS = ["Ostrze pulsacyjne","≈öciana energetyczna"];
const MAX_PLAYERS_PER_TEAM = 7;

let activePlayer = null;
let teamsData = { A:{}, B:{} };

/* ===== RENDER DRU≈ªYN ===== */
function renderTeam(team){
  db.ref("teams/"+team).on("value", snap=>{
    teamsData[team] = snap.val() || {};
    const box = document.getElementById("team"+team);
    box.innerHTML = "";

    Object.entries(teamsData[team]).forEach(([id,p])=>{
      const div = document.createElement("div");
      div.className = "player";

      div.innerHTML = `
        <input value="${p.nick||''}" ${isAdmin ? "" : "disabled"}>
        <div class="loadout">
          <span class="titan">${p.titan||'‚Äî'}</span>
          <span class="heavy">${p.heavy||'‚Äî'}</span>
          <span class="tactical">${p.tactical||'‚Äî'}</span>
        </div>`;

      if(activePlayer && activePlayer.id===id) div.classList.add("active");

      div.onclick = ()=>{
        document.querySelectorAll(".player").forEach(el=>el.classList.remove("active"));
        activePlayer={team,id,playerData:{...p}};
        div.classList.add("active");
        renderOptions();
      };

      const input = div.querySelector("input");
      input.onclick = e => e.stopPropagation();

      if(isAdmin){
        const original = p.nick||"";
        input.addEventListener("keydown", e=>{
          if(e.key==="Enter"){
            db.ref(`teams/${team}/${id}/nick`).set(input.value);
            input.blur();
          }
          if(e.key==="Escape"){
            input.value = original;
            input.blur();
          }
        });
      }

      box.appendChild(div);
    });

    renderOptions();
    highlightDuplicates(team);
  });
}
renderTeam("A"); renderTeam("B");

/* ===== ADMIN (ZABLOKOWANY DLA NIE-ADMINA) ===== */
function addPlayer(){ if(!isAdmin) return;
  const team = Object.keys(teamsData.A||{}).length <= Object.keys(teamsData.B||{}).length ? "A":"B";
  if(Object.keys(teamsData[team]||{}).length >= MAX_PLAYERS_PER_TEAM) return alert("Limit dru≈ºyny");
  db.ref(`teams/${team}/p${Date.now()}`).set({nick:"Nowy gracz",titan:"",heavy:"",tactical:""});
}
function removePlayer(){ if(!isAdmin) return;
  if(!activePlayer) return;
  db.ref(`teams/${activePlayer.team}/${activePlayer.id}`).remove();
}
function movePlayer(){ if(!isAdmin) return;
  if(!activePlayer) return;
  const from=activePlayer.team,to=from==="A"?"B":"A";
  db.ref(`teams/${from}/${activePlayer.id}`).once("value",snap=>{
    const data=snap.val();
    if(!data) return;
    const u={};
    u[`teams/${to}/${activePlayer.id}`]=data;
    u[`teams/${from}/${activePlayer.id}`]=null;
    db.ref().update(u);
  });
}
function resetLoadouts(){ if(!isAdmin) return;
  ['A','B'].forEach(t=>{
    Object.keys(teamsData[t]||{}).forEach(id=>{
      db.ref(`teams/${t}/${id}`).update({titan:"",heavy:"",tactical:""});
    });
  });
}
</script>
</body>
</html>
