<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Loadout Live</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body { margin:0; background:#111; color:#eee; font-family:Arial,sans-serif; }
h2 { text-align:center; margin:15px 0; }
.container { display:flex; gap:60px; padding:20px; }
.team { flex:1; background:#1e1e1e; padding:15px; border-radius:10px; }
.player { background:#2b2b2b; padding:8px; margin-bottom:6px; border-radius:6px; cursor:pointer; }
.player.active { outline:2px solid #4caf50; }
.player input { width:95%; font-weight:bold; background:#222; color:#eee; border:none; outline:none; }
.loadout span { margin-right:10px; opacity:0.85; padding:2px 4px; border-radius:4px; }
.loadout span.duplicate { outline:2px solid #ff3333; color:#ff9999; }

.panel-container { display:flex; gap:60px; padding:0 20px; }
.panel { flex:1; margin-top:10px; padding:15px; background:#1b1b1b; border-radius:10px; }
.section { margin-bottom:12px; }
.options { display:flex; flex-wrap:wrap; gap:6px; }
.option { padding:6px 10px; background:#444; border-radius:5px; cursor:pointer; user-select:none; }
.option.disabled { opacity:0.3; cursor:not-allowed; }
.option.active { outline:2px solid #4caf50; }
.option.duplicate { outline:2px solid #ff3333; background:#552222; }

.admin { text-align:center; margin-bottom:15px; }
button { padding:6px 12px; margin:4px; }
select { padding:6px; }
</style>
</head>
<body>

<h2>Loadout Live</h2>

<div class="container">
  <div class="team">
    <h3>Drużyna A</h3>
    <div id="teamA"></div>
  </div>
  <div class="team">
    <h3>Drużyna B</h3>
    <div id="teamB"></div>
  </div>
</div>

<div class="panel-container">
  <div class="panel">
    <h4>Opcje Drużyny A</h4>
    <div class="section"><b>Tytany</b><div class="options" id="titansA"></div></div>
    <div class="section"><b>Bronie ciężkie</b><div class="options" id="weaponsA"></div></div>
    <div class="section"><b>Umiejętności taktyczne</b><div class="options" id="tacticalsA"></div></div>
  </div>

  <div class="panel">
    <h4>Opcje Drużyny B</h4>
    <div class="section"><b>Tytany</b><div class="options" id="titansB"></div></div>
    <div class="section"><b>Bronie ciężkie</b><div class="options" id="weaponsB"></div></div>
    <div class="section"><b>Umiejętności taktyczne</b><div class="options" id="tacticalsB"></div></div>
  </div>
</div>

<script>
/* ===== FIREBASE ===== */
const firebaseConfig = {
  apiKey: "AIzaSyCIi8Jl0rEPsNOfFERMUSl-MV3lDiEOsVI",
  authDomain: "tabela-turniejowa-titanfall-2.firebaseapp.com",
  databaseURL: "https://tabela-turniejowa-titanfall-2-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "tabela-turniejowa-titanfall-2",
  storageBucket: "tabela-turniejowa-titanfall-2.firebasestorage.app",
  messagingSenderId: "887537927614",
  appId: "1:887537927614:web:28f6f7e303e1a57d00e5ef"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ===== STAŁE ===== */
const TITANS = ["Kationa","Spopielacz","Polaris","Ronin","Ton","Legion","Monarcha"];
const WEAPONS = ["Granat odłamkowy","Granat łukowy","Ognista gwiazda","Gwiazda grawitacyjna","Granat elektro-dymny","Ciężki ładunek wybuchowy"];
const TACTICALS = ["Maskowanie","Ostrze pulsacyjne","Linka z hakiem","Stymulant","Ściana energetyczna","Przeskok fazowy","Holopilot"];
const LIMITED_TACTICALS = ["Ostrze pulsacyjne","Ściana energetyczna"];

let activePlayer = null;
let teamsData = { A:{}, B:{} };

/* ===== DUPLIKATY ===== */
function getDuplicates(team, field){
  const count = {};
  Object.values(teamsData[team]||{}).forEach(p=>{
    const val = p[field];
    if(!val) return;
    if(field==="heavy" && val==="Ognista gwiazda") return;
    if(field==="tactical" && !LIMITED_TACTICALS.includes(val)) return;
    count[val] = (count[val]||0)+1;
  });
  return Object.keys(count).filter(v=>count[v]>1);
}

/* ===== RENDER ===== */
function renderTeam(team){
  db.ref("teams/"+team).on("value", snap=>{
    teamsData[team] = snap.val() || {};
    const box = document.getElementById("team"+team);
    box.innerHTML = "";

    const dupTit = getDuplicates(team,"titan");
    const dupHvy = getDuplicates(team,"heavy");
    const dupTac = getDuplicates(team,"tactical");

    Object.entries(teamsData[team]).forEach(([id,p])=>{
      const div = document.createElement("div");
      div.className="player";

      div.innerHTML=`
        <input value="${p.nick||''}" disabled>
        <div class="loadout">
          <span class="${dupTit.includes(p.titan)?'duplicate':''}">${p.titan||'—'}</span>
          <span class="${dupHvy.includes(p.heavy)?'duplicate':''}">${p.heavy||'—'}</span>
          <span class="${dupTac.includes(p.tactical)?'duplicate':''}">${p.tactical||'—'}</span>
        </div>
      `;
      box.appendChild(div);
    });

    renderOptions();
  });
}
renderTeam("A"); renderTeam("B");

/* ===== OPCJE ===== */
function renderOptions(){
  ["A","B"].forEach(team=>{
    const dupTit = getDuplicates(team,"titan");
    const dupHvy = getDuplicates(team,"heavy");
    const dupTac = getDuplicates(team,"tactical");

    makeOptions(TITANS,`titans${team}`,dupTit);
    makeOptions(WEAPONS,`weapons${team}`,dupHvy);
    makeOptions(TACTICALS,`tacticals${team}`,dupTac);
  });
}

function makeOptions(list,target,dups){
  const el=document.getElementById(target);
  el.innerHTML="";
  list.forEach(v=>{
    const o=document.createElement("div");
    o.className="option";
    o.innerText=v;
    if(dups.includes(v)) o.classList.add("duplicate");
    el.appendChild(o);
  });
}
</script>

</body>
</html>
