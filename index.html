<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Tabela turniejowa Titanfall 2</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
  margin:0;
  background:#111;
  color:#eee;
  font-family:Arial, sans-serif;
}
h2 { text-align:center; margin:15px 0; }

.container {
  display:flex;
  gap:60px;
  padding:20px;
}

.team {
  flex:1;
  background:#1e1e1e;
  padding:15px;
  border-radius:10px;
}

.player {
  background:#2b2b2b;
  padding:8px;
  margin-bottom:6px;
  border-radius:6px;
  cursor:pointer;
}
.player.active { outline:2px solid #4caf50; }

.player input {
  width:95%;
  font-weight:bold;
  background:#222;
  color:#eee;
  border:none;
  outline:none;
}

.loadout span {
  margin-right:10px;
  opacity:0.85;
}

.panel {
  margin:20px;
  padding:15px;
  background:#1b1b1b;
  border-radius:10px;
}

.section { margin-bottom:12px; }

.options {
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}

.option {
  padding:6px 10px;
  background:#444;
  border-radius:5px;
  cursor:pointer;
  user-select:none;
}
.option.disabled {
  opacity:0.3;
  cursor:not-allowed;
}

.admin {
  text-align:center;
  margin-bottom:15px;
}
button {
  padding:6px 12px;
  margin:4px;
}
select {
  padding:6px;
}
</style>
</head>

<body>

<h2>Loadout Live</h2>

<div class="container">
  <div class="team">
    <h3>DruÅ¼yna A</h3>
    <div id="teamA"></div>
  </div>
  <div class="team">
    <h3>DruÅ¼yna B</h3>
    <div id="teamB"></div>
  </div>
</div>

<div class="panel">
  <div class="section">
    <b>Tytany</b>
    <div class="options" id="titans"></div>
  </div>
  <div class="section">
    <b>Bronie ciÄ™Å¼kie</b>
    <div class="options" id="weapons"></div>
  </div>
  <div class="section">
    <b>UmiejÄ™tnoÅ›ci taktyczne</b>
    <div class="options" id="tacticals"></div>
  </div>
</div>

<div class="admin" id="adminPanel" style="display:none">
  <button onclick="addPlayer()">âž• Dodaj gracza</button>
  <button onclick="movePlayer()">â‡„ PrzenieÅ› gracza</button>
  <button onclick="resetLoadouts()">ðŸ”„ Reset loadoutÃ³w</button>
  <br><br>
  Tryb:
  <select onchange="setMode(this.value)">
    <option value="10">10 graczy</option>
    <option value="12">12 graczy</option>
    <option value="14">14 graczy</option>
  </select>
</div>

<script>
/* ===== FIREBASE ===== */
const firebaseConfig = {
  apiKey: "AIzaSyCIi8Jl0rEPsNOfFERMUSl-MV3lDiEOsVI",
  authDomain: "tabela-turniejowa-titanfall-2.firebaseapp.com",
  databaseURL: "https://tabela-turniejowa-titanfall-2-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "tabela-turniejowa-titanfall-2",
  storageBucket: "tabela-turniejowa-titanfall-2.firebasestorage.app",
  messagingSenderId: "887537927614",
  appId: "1:887537927614:web:28f6f7e303e1a57d00e5ef"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ===== ADMIN ===== */
const isAdmin = location.search.includes("admin=1");
if(isAdmin) document.getElementById("adminPanel").style.display="block";

/* ===== DANE ===== */
const TITANS = ["Kationa","Spopielacz","Polaris","Ronin","Ton","Legion","Monarcha"];
const WEAPONS = ["Granat odÅ‚amkowy","Granat Å‚ukowy","Ognista gwiazda","Gwiazda grawitacyjna","Granat elektro-dymny","CiÄ™Å¼ki Å‚adunek wybuchowy"];
const TACTICALS = ["Maskowanie","Ostrze pulsacyjne","Linka z hakiem","Stymulant","Åšciana energetyczna","Przeskok fazowy","Holopilot"];
const LIMITED_TACTICALS = ["Ostrze pulsacyjne","Åšciana energetyczna"];

let activePlayer = null;
let teamsData = { A:{}, B:{} };
let maxPlayers = 10;

/* ===== RENDER DRUÅ»YN ===== */
function renderTeam(team) {
  db.ref("teams/"+team).on("value", snap=>{
    teamsData[team] = snap.val() || {};
    const box = document.getElementById("team"+team);
    box.innerHTML = "";

    Object.entries(teamsData[team]).forEach(([id,p])=>{
      const div = document.createElement("div");
      div.className = "player";
      if(activePlayer && activePlayer.id === id) div.classList.add("active");

      div.innerHTML = `
        <input value="${p.nick || ""}" ${isAdmin ? "" : "disabled"} />
        <div class="loadout">
          <span>${p.titan || "â€”"}</span>
          <span>${p.heavy || "â€”"}</span>
          <span>${p.tactical || "â€”"}</span>
        </div>
      `;

      div.onclick = ()=> activePlayer = { team, id };

      const input = div.querySelector("input");
      input.onclick = e => e.stopPropagation();
      input.oninput = ()=> {
        db.ref(\`teams/${team}/${id}/nick\`).set(input.value);
      };

      box.appendChild(div);
    });

    renderOptions();
  });
}
renderTeam("A");
renderTeam("B");

/* ===== BLOKADY ===== */
function isTaken(team, field, value) {
  return Object.values(teamsData[team]).some(p => p[field] === value);
}
function canUse(team, field, value) {
  if(field==="titan") return !isTaken(team,"titan",value);
  if(field==="heavy" && value!=="Ognista gwiazda")
    return !isTaken(team,"heavy",value);
  if(field==="tactical" && LIMITED_TACTICALS.includes(value))
    return !isTaken(team,"tactical",value);
  return true;
}

/* ===== PANEL WYBORU ===== */
function renderOptions() {
  makeOptions(TITANS,"titans","titan");
  makeOptions(WEAPONS,"weapons","heavy");
  makeOptions(TACTICALS,"tacticals","tactical");
}

function makeOptions(list,target,field) {
  const el=document.getElementById(target);
  el.innerHTML="";
  list.forEach(val=>{
    const o=document.createElement("div");
    o.className="option";
    o.innerText=val;

    if(activePlayer && !canUse(activePlayer.team,field,val))
      o.classList.add("disabled");

    o.onclick=()=>{
      if(!activePlayer) return alert("Najpierw wybierz gracza");
      if(!canUse(activePlayer.team,field,val)) return;
      db.ref(\`teams/${activePlayer.team}/${activePlayer.id}/${field}\`).set(val);
    };
    el.appendChild(o);
  });
}

/* ===== ADMIN FUNKCJE ===== */
function addPlayer() {
  const total =
    Object.keys(teamsData.A).length +
    Object.keys(teamsData.B).length;
  if(total >= maxPlayers) return alert("OsiÄ…gniÄ™to limit graczy");

  const team =
    Object.keys(teamsData.A).length <=
    Object.keys(teamsData.B).length ? "A" : "B";

  const id = "p" + Date.now();
  db.ref(`teams/${team}/${id}`).set({
    nick:"Nowy gracz",
    titan:"",
    heavy:"",
    tactical:""
  });
}

function movePlayer() {
  if(!activePlayer) return;
  const from=activePlayer.team;
  const to=from==="A"?"B":"A";
  const id=activePlayer.id;

  db.ref(`teams/${from}/${id}`).once("value",snap=>{
    const data=snap.val();
    if(!data) return;
    const updates={};
    updates[`teams/${to}/${id}`]=data;
    updates[`teams/${from}/${id}`]=null;
    db.ref().update(updates);
    activePlayer=null;
  });
}

function resetLoadouts() {
  ["A","B"].forEach(team=>{
    Object.keys(teamsData[team]).forEach(id=>{
      db.ref(`teams/${team}/${id}`).update({
        titan:"",
        heavy:"",
        tactical:""
      });
    });
  });
}

function setMode(val) {
  maxPlayers = parseInt(val);
}
</script>

</body>
</html>
