<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Loadout Live</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
  background:#111;
  color:#eee;
  font-family:Arial;
  margin:0;
}

h2 { text-align:center; }

.container {
  display:flex;
  gap:60px;
  padding:20px;
}

.team {
  flex:1;
  background:#1e1e1e;
  padding:15px;
  border-radius:10px;
}

.player {
  background:#2b2b2b;
  padding:8px;
  margin-bottom:6px;
  border-radius:6px;
  cursor:pointer;
}

.player.active {
  outline:2px solid #4caf50;
}

.loadout span {
  margin-right:10px;
  opacity:0.8;
}

.panel {
  margin:20px;
  padding:15px;
  background:#1b1b1b;
  border-radius:10px;
}

.section {
  margin-bottom:10px;
}

.options {
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}

.option {
  padding:6px 10px;
  background:#444;
  border-radius:5px;
  cursor:pointer;
}

.option.disabled {
  opacity:0.3;
  cursor:not-allowed;
}

.admin {
  margin:10px;
  text-align:center;
}

button {
  padding:6px 12px;
}
</style>
</head>

<body>

<h2>Loadout Live</h2>

<div class="container">
  <div class="team">
    <h3>Drużyna A</h3>
    <div id="teamA"></div>
  </div>

  <div class="team">
    <h3>Drużyna B</h3>
    <div id="teamB"></div>
  </div>
</div>

<div class="panel">
  <div class="section">
    <b>Tytany</b>
    <div class="options" id="titans"></div>
  </div>
  <div class="section">
    <b>Bronie ciężkie</b>
    <div class="options" id="weapons"></div>
  </div>
  <div class="section">
    <b>Taktyczne</b>
    <div class="options" id="tacticals"></div>
  </div>
</div>

<div class="admin" id="adminPanel" style="display:none">
  <button onclick="movePlayer()">⇄ Przenieś do drugiej drużyny</button>
  <button onclick="resetLoadout()">Reset loadoutów</button>
</div>

<script>
/* ===== FIREBASE ===== */
const firebaseConfig = {
  apiKey: "AIzaSyCIi8Jl0rEPsNOfFERMUSl-MV3lDiEOsVI",
  authDomain: "tabela-turniejowa-titanfall-2.firebaseapp.com",
  databaseURL: "https://tabela-turniejowa-titanfall-2-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "tabela-turniejowa-titanfall-2",
  storageBucket: "tabela-turniejowa-titanfall-2.firebasestorage.app",
  messagingSenderId: "887537927614",
  appId: "1:887537927614:web:28f6f7e303e1a57d00e5ef"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const isAdmin = location.search.includes("admin=1");
if(isAdmin) document.getElementById("adminPanel").style.display="block";

/* ===== DANE ===== */
const TITANS = ["Kationa","Spopielacz","Polaris","Ronin","Ton","Legion","Monarcha"];
const WEAPONS = ["Granat odłamkowy","Granat łukowy","Ognista gwiazda","Gwiazda grawitacyjna","Granat elektro-dymny","Ciężki ładunek wybuchowy"];
const TACTICALS = ["Maskowanie","Ostrze pulsacyjne","Linka z hakiem","Stymulant","Ściana energetyczna","Przeskok fazowy","Holopilot"];

let activePlayer = null;

/* ===== RENDER GRACZY ===== */
function renderTeam(team) {
  db.ref("teams/"+team).on("value", snap=>{
    const box = document.getElementById("team"+team);
    box.innerHTML="";
    const data = snap.val()||{};
    Object.entries(data).forEach(([id,p])=>{
      const div=document.createElement("div");
      div.className="player";
      if(activePlayer && activePlayer.id===id) div.classList.add("active");
      div.innerHTML=`
        div.innerHTML = `
  <input
    value="${p.nick || ""}"
    ${isAdmin ? "" : "disabled"}
    style="font-weight:bold; width:90%; background:#222; color:#eee; border:none;"
  />
  <div class="loadout">
    <span>${p.titan || "—"}</span>
    <span>${p.heavy || "—"}</span>
    <span>${p.tactical || "—"}</span>
  </div>
`;
const input = div.querySelector("input");

input.onclick = (e) => {
  e.stopPropagation(); // ← KLUCZ
};

input.oninput = () => {
  db.ref(`teams/${team}/${id}/nick`).set(input.value);
};

        <div class="loadout">
          <span>${p.titan||"—"}</span>
          <span>${p.heavy||"—"}</span>
          <span>${p.tactical||"—"}</span>
        </div>`;
      div.onclick=()=>activePlayer={team,id};
      div.querySelector("b").oninput=e=>{
        db.ref(`teams/${team}/${id}/nick`).set(e.target.innerText);
      };
      box.appendChild(div);
    });
  });
}
renderTeam("A");
renderTeam("B");

/* ===== PANEL WYBORU ===== */
function makeOptions(list, target, field){
  const el=document.getElementById(target);
  list.forEach(val=>{
    const o=document.createElement("div");
    o.className="option";
    o.innerText=val;
    o.onclick=()=>{
      if(!activePlayer) return alert("Najpierw wybierz gracza");
      db.ref(`teams/${activePlayer.team}/${activePlayer.id}/${field}`).set(val);
    };
    el.appendChild(o);
  });
}
makeOptions(TITANS,"titans","titan");
makeOptions(WEAPONS,"weapons","heavy");
makeOptions(TACTICALS,"tacticals","tactical");

/* ===== ADMIN ===== */
function movePlayer(){
  if(!activePlayer) return;

  const from = activePlayer.team;
  const to = from === "A" ? "B" : "A";
  const id = activePlayer.id;

  db.ref(`teams/${from}/${id}`).once("value", snap => {
    const playerData = snap.val();
    if(!playerData) return;

    const updates = {};
    updates[`teams/${to}/${id}`] = playerData;
    updates[`teams/${from}/${id}`] = null;

    db.ref().update(updates);
    activePlayer = null;
  });
}

function resetLoadout(){
  ["A","B"].forEach(team=>{
    db.ref("teams/"+team).once("value",snap=>{
      const d=snap.val()||{};
      Object.keys(d).forEach(id=>{
        db.ref(`teams/${team}/${id}`).update({
          titan:"",
          heavy:"",
          tactical:""
        });
      });
    });
  });
}
</script>

</body>
</html>
