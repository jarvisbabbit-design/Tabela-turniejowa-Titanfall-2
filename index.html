<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Tabela turniejowa Titanfall 2</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body { margin:0; background:#111; color:#eee; font-family:Arial,sans-serif; }
h2 { text-align:center; margin:15px 0; }
.container { display:flex; gap:60px; padding:20px; }
.team { flex:1; background:#1e1e1e; padding:15px; border-radius:10px; }
.player { background:#2b2b2b; padding:8px; margin-bottom:6px; border-radius:6px; cursor:pointer; }
.player.active { outline:2px solid #4caf50; }
.player.duplicate { border:2px solid red; }
.player input { width:95%; font-weight:bold; background:#222; color:#eee; border:none; outline:none; }
.loadout span { margin-right:10px; opacity:0.85; }
.loadout span.duplicate { color:red; }
.panel-container { display:flex; gap:60px; padding:0 20px; }
.panel { flex:1; margin-top:10px; padding:15px; background:#1b1b1b; border-radius:10px; }
.section { margin-bottom:12px; }
.options { display:flex; flex-wrap:wrap; gap:6px; }
.option { padding:6px 10px; background:#444; border-radius:5px; cursor:pointer; user-select:none; }
.option.disabled { background: #2f2f2f; color: #999; cursor: not-allowed; }
.option.disabled.active { outline: 2px solid #4caf50; background: #2f2f2f; color: #ccc; }
.option.active { outline:2px solid #4caf50; }
.option.duplicate { background:red; color:#fff; border:2px solid red; }
.duplicate-warning { color:red; font-weight:bold; margin-bottom:5px; }
.admin { text-align:center; margin-bottom:15px; }
button { padding:6px 12px; margin:4px; }
select { padding:6px; }
</style>
</head>
<body>

<h2>Tabela turniejowa Titanfall 2</h2>

<div class="container">
  <div class="team">
    <h3>Dru≈ºyna A</h3>
    <div id="teamA"></div>
    <div id="dupWarningA" class="duplicate-warning" style="display:none">‚ö†Ô∏è Duplikaty w dru≈ºynie!</div>
  </div>
  <div class="team">
    <h3>Dru≈ºyna B</h3>
    <div id="teamB"></div>
    <div id="dupWarningB" class="duplicate-warning" style="display:none">‚ö†Ô∏è Duplikaty w dru≈ºynie!</div>
  </div>
</div>

<div class="panel-container">
  <div class="panel">
    <h4>Opcje Dru≈ºyny A</h4>
    <div class="section"><b>Tytany</b><div class="options" id="titansA"></div></div>
    <div class="section"><b>Bronie ciƒô≈ºkie</b><div class="options" id="weaponsA"></div></div>
    <div class="section"><b>Umiejƒôtno≈õci taktyczne</b><div class="options" id="tacticalsA"></div></div>
  </div>

  <div class="panel">
    <h4>Opcje Dru≈ºyny B</h4>
    <div class="section"><b>Tytany</b><div class="options" id="titansB"></div></div>
    <div class="section"><b>Bronie ciƒô≈ºkie</b><div class="options" id="weaponsB"></div></div>
    <div class="section"><b>Umiejƒôtno≈õci taktyczne</b><div class="options" id="tacticalsB"></div></div>
  </div>
</div>

<div class="admin" id="adminPanel" style="display:block">
  <button onclick="addPlayer()">‚ûï Dodaj gracza</button>
  <button onclick="removePlayer()">‚ûñ Usu≈Ñ gracza</button>
  <button onclick="movePlayer()">‚áÑ Przenie≈õ gracza</button>
  <button onclick="resetLoadouts()">üîÑ Reset loadout√≥w</button>
</div>

<script>
/* ===== FIREBASE ===== */
const firebaseConfig = {
  apiKey: "AIzaSyCIi8Jl0rEPsNOfFERMUSl-MV3lDiEOsVI",
  authDomain: "tabela-turniejowa-titanfall-2.firebaseapp.com",
  databaseURL: "https://tabela-turniejowa-titanfall-2-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "tabela-turniejowa-titanfall-2",
  storageBucket: "tabela-turniejowa-titanfall-2.firebasestorage.app",
  messagingSenderId: "887537927614",
  appId: "1:887537927614:web:28f6f7e303e1a57d00e5ef"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const ADMIN_PASSWORD = "strach";

let isAdmin = false;

// sprawdzamy czy admin ju≈º zalogowany w tej sesji
if (sessionStorage.getItem("isAdmin") === "1") {
  isAdmin = true;
}

// je≈õli kto≈õ wchodzi z ?admin=1 i nie jest zalogowany
if (!isAdmin && location.search.includes("admin=1")) {
  const pass = prompt("Podaj has≈Ço admina:");
  if (pass === ADMIN_PASSWORD) {
    isAdmin = true;
    sessionStorage.setItem("isAdmin", "1");
  } else {
    alert("B≈Çƒôdne has≈Ço");
  }
}

// pokazanie / ukrycie panelu admina
document.getElementById("adminPanel").style.display = isAdmin ? "block" : "none";


/* ===== STA≈ÅE ===== */
const TITANS = ["Kationa","Spopielacz","Polaris","Ronin","Ton","Legion","Monarcha"];
const WEAPONS = ["Granat od≈Çamkowy","Granat ≈Çukowy","Ognista gwiazda","Gwiazda grawitacyjna","Granat elektro-dymny","Ciƒô≈ºki ≈Çadunek wybuchowy"];
const TACTICALS = ["Maskowanie","Ostrze pulsacyjne","Linka z hakiem","Stymulant","≈öciana energetyczna","Przeskok fazowy","Holopilot"];
const LIMITED_TACTICALS = ["Ostrze pulsacyjne","≈öciana energetyczna"];
const MAX_PLAYERS_PER_TEAM = 7;

let activePlayer = null;
let teamsData = { A:{}, B:{} };

/* ===== RENDER DRU≈ªYN ===== */
function renderTeam(team){
  db.ref("teams/"+team).on("value", snap=>{
    teamsData[team] = snap.val() || {};
    const box = document.getElementById("team"+team);
    box.innerHTML = "";
    Object.entries(teamsData[team]).forEach(([id,p])=>{
      const div = document.createElement("div");
      div.className = "player";
      div.innerHTML=`
       <input value="${p.nick||''}" ${isAdmin ? "" : "disabled"}>
       <div class="loadout">
          <span class="titan">${p.titan||'‚Äî'}</span>
          <span class="heavy">${p.heavy||'‚Äî'}</span>
          <span class="tactical">${p.tactical||'‚Äî'}</span>
        </div>`;
      if(activePlayer && activePlayer.id===id) div.classList.add("active");

      div.onclick = ()=>{
        document.querySelectorAll(".player").forEach(el=>el.classList.remove("active"));
        activePlayer={team,id,playerData:{...p}};
        div.classList.add("active");
        renderOptions();
      };

const input = div.querySelector("input");
input.onclick = e => e.stopPropagation();

if(isAdmin){
  const originalNick = p.nick || "";

  input.addEventListener("keydown", e=>{
    if(e.key === "Enter"){
      db.ref(`teams/${team}/${id}/nick`).set(input.value);
      input.blur();
    }

    if(e.key === "Escape"){
      input.value = originalNick;
      input.blur();
    }
  });
}

      box.appendChild(div);
    });
    renderOptions();
    highlightDuplicates(team);
  });
}
renderTeam("A"); renderTeam("B");

/* ===== BLOKADY ===== */
function canUse(field,value,team,idIgnore){
  let taken=false;
  Object.entries(teamsData[team]||{}).forEach(([id,p])=>{
    if(idIgnore===id) return;
    if(field==="titan" && p.titan===value) taken=true;
    if(field==="heavy" && value!=="Ognista gwiazda" && p.heavy===value) taken=true;
    if(field==="tactical" && LIMITED_TACTICALS.includes(value) && p.tactical===value) taken=true;
  });
  return !taken;
}

/* ===== PANEL OPCJI ===== */
function renderOptions(){
  ['A','B'].forEach(team=>renderTeamOptions(team));
}

function renderTeamOptions(team){
  makeOptions(TITANS,`titans${team}`,"titan",team);
  makeOptions(WEAPONS,`weapons${team}`,"heavy",team);
  makeOptions(TACTICALS,`tacticals${team}`,"tactical",team);
}

function makeOptions(list,target,field,team){
  const el=document.getElementById(target); el.innerHTML="";
  list.forEach(val=>{
    const o=document.createElement("div");
    o.className="option"; o.innerText=val;

    // üîí STA≈ÅE WYSZARZENIE ZAJƒòTYCH OPCJI (niezale≈ºnie od aktywnego gracza)
let takenByTeam = false;

Object.entries(teamsData[team] || {}).forEach(([id, p]) => {
  if (field === "titan" && p.titan === val) takenByTeam = true;
  if (field === "heavy" && val !== "Ognista gwiazda" && p.heavy === val) takenByTeam = true;
  if (field === "tactical" && LIMITED_TACTICALS.includes(val) && p.tactical === val) takenByTeam = true;
});

if (takenByTeam) {
  o.classList.add("disabled");
}

    // aktywny gracz
if(activePlayer && activePlayer.team===team){
  const current = activePlayer.playerData[field];
  if(current===val) o.classList.add("active");
  else if(!canUse(field,val,team,activePlayer.id)) {
    o.classList.add("disabled");
  }
} 

    o.onclick = ()=>{
      if(!activePlayer || activePlayer.team!==team) return alert("Najpierw wybierz gracza z tej dru≈ºyny");
      const current = activePlayer.playerData[field];

      if(current===val){
        db.ref(`teams/${team}/${activePlayer.id}/${field}`).set("").then(()=>{
          activePlayer.playerData[field]="";
          renderOptions();
        });
        return;
      }

      if(!canUse(field,val,team,activePlayer.id)) return;
      db.ref(`teams/${team}/${activePlayer.id}/${field}`).set(val).then(()=>{
        activePlayer.playerData[field]=val;
        renderOptions();
      });
    };

    el.appendChild(o);
  });
}

/* ===== DUPLIKATY ===== */
function highlightDuplicates(team){
  const data = teamsData[team]||{};
  const tytans = {}, heavy = {}, tacticals = {};
  let dupExists = false;

  Object.values(data).forEach(p=>{
    if(p.titan){ tytans[p.titan] = (tytans[p.titan]||0)+1; }
    if(p.heavy && p.heavy!=="Ognista gwiazda"){ heavy[p.heavy] = (heavy[p.heavy]||0)+1; }
    if(p.tactical && LIMITED_TACTICALS.includes(p.tactical)){ tacticals[p.tactical] = (tacticals[p.tactical]||0)+1; }
  });

  Object.entries(data).forEach(([id,p])=>{
    const div = document.querySelector(`#team${team} .player:nth-child(${Object.keys(data).indexOf(id)+1})`);
    div.classList.remove("duplicate");
    div.querySelectorAll(".loadout span").forEach(span=>span.classList.remove("duplicate"));
    // tytan
    if(p.titan && tytans[p.titan]>1){ 
      div.classList.add("duplicate"); dupExists=true;
      div.querySelector(".titan").classList.add("duplicate");
    }
    // heavy
    if(p.heavy && p.heavy!=="Ognista gwiazda" && heavy[p.heavy]>1){
      div.classList.add("duplicate"); dupExists=true;
      div.querySelector(".heavy").classList.add("duplicate");
    }
    // tactical
    if(p.tactical && LIMITED_TACTICALS.includes(p.tactical) && tacticals[p.tactical]>1){
      div.classList.add("duplicate"); dupExists=true;
      div.querySelector(".tactical").classList.add("duplicate");
    }
  });

  // ostrze≈ºenie nad dru≈ºynƒÖ
  document.getElementById(`dupWarning${team}`).style.display = dupExists?"block":"none";

  // pod≈õwietlenie w panelu opcji
  ['titans','weapons','tacticals'].forEach(section=>{
    const el = document.getElementById(section+team);
    el.querySelectorAll(".option").forEach(opt=>{
      opt.classList.remove("duplicate");
      if(section==="titans" && tytans[opt.innerText]>1) opt.classList.add("duplicate");
      if(section==="weapons" && opt.innerText!=="Ognista gwiazda" && heavy[opt.innerText]>1) opt.classList.add("duplicate");
      if(section==="tacticals" && LIMITED_TACTICALS.includes(opt.innerText) && tacticals[opt.innerText]>1) opt.classList.add("duplicate");
    });
  });
}

/* ===== ADMIN ===== */
function addPlayer(){
  if(!isAdmin) return;
  const total = Object.keys(teamsData.A||{}).length + Object.keys(teamsData.B||{}).length;
  const team = (Object.keys(teamsData.A||{}).length <= Object.keys(teamsData.B||{}).length) ? "A":"B";
  if(Object.keys(teamsData[team]||{}).length >= MAX_PLAYERS_PER_TEAM) return alert("OsiƒÖgniƒôto limit graczy w dru≈ºynie");
  const id="p"+Date.now();
  db.ref(`teams/${team}/${id}`).set({nick:"Nowy gracz",titan:"",heavy:"",tactical:""});
}

function removePlayer(){
  if(!isAdmin) return alert("Najpierw wybierz gracza do usuniƒôcia");
  const team = activePlayer.team;
  const id = activePlayer.id;
  if(confirm(`Na pewno chcesz usunƒÖƒá gracza ${activePlayer.playerData.nick}?`)){
    db.ref(`teams/${team}/${id}`).remove().then(()=>{
      activePlayer = null;
      renderTeam(team);
    });
  }
}

function movePlayer(){
  if(!isAdmin) return;
  const from=activePlayer.team, to=(from==="A")?"B":"A", id=activePlayer.id;
  db.ref(`teams/${from}/${id}`).once("value",snap=>{
    const data=snap.val(); if(!data) return;
    const updates={};
    updates[`teams/${to}/${id}`]=data;
    updates[`teams/${from}/${id}`]=null;
    db.ref().update(updates);
    activePlayer=null;
  });
}

function resetLoadouts(){
  if(!isAdmin) return;
   ['A','B'].forEach(team=>{
    Object.keys(teamsData[team]||{}).forEach(id=>{
      db.ref(`teams/${team}/${id}`).update({titan:"",heavy:"",tactical:""});
    });
  });
}
</script>
</body>

</html>






